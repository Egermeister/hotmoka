# docker build -t hotmoka/single-validator:latest -f dockerfiles/single-validator/single-validator .
# docker run -dit -e INITIAL_SUPPLY=123456789 -e OPEN_UNSIGNED_FAUCET=false -e PASSWORD_OF_GAMETE=secret -e CHAIN_ID=id hotmoka/single-validator:latest

# in the future, move to 11.0.13-jre-slim
FROM openjdk:11.0.13
LABEL "maintainer"="fausto.spoto@hotmoka.io"

USER root
WORKDIR /usr/local/bin

# install missing packages
RUN apt-get update \
  && apt-get install -y wget \
  && rm -rf /var/lib/apt/lists/*

# create hotmoka user
RUN groupadd -r hotmoka \
  && useradd --no-log-init -r -m -g hotmoka hotmoka

# install moka
COPY modules/ /modules/
RUN echo java --module-path /modules/explicit:/modules/automatic --class-path \"/modules/unnamed/*\" --module io.hotmoka.tools/io.hotmoka.tools.Moka \"\$@\" > moka \
  && chmod a+x moka

# install tendermint
RUN wget https://github.com/tendermint/tendermint/releases/download/v0.34.14/tendermint_0.34.14_linux_amd64.tar.gz \
  && tar -zxvf tendermint_0.34.14_linux_amd64.tar.gz tendermint \
  && chown root.staff tendermint \
  && chmod 755 tendermint \
  && rm tendermint_*.tar.gz

# install control scripts
COPY dockerfiles/single-validator/init.sh init.sh
RUN chmod 755 init.sh

USER hotmoka
WORKDIR /home/hotmoka

# by default, turn up a brand new node
CMD init.sh